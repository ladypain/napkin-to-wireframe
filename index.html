<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Wireframes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        .container { max-width: 1200px; margin: 0 auto; }
        .canvas-wrapper { display: flex; gap: 20px; margin-top: 20px; }
        .canvas-container { flex: 1; background: white; border: 1px solid #ccc; border-radius: 4px; }
        .tools { margin-bottom: 10px; }
        button { padding: 8px 16px; margin-right: 10px; cursor: pointer; }
        #message { padding: 10px; margin: 10px 0; border-radius: 4px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Creador de Wireframes</h1>
        <div class="tools">
            <button onclick="toggleDrawingMode()">Modo Dibujo</button>
            <button onclick="clearCanvases()">Limpiar</button>
            <button onclick="interpretWireframe()">Interpretar</button>
            <button onclick="downloadWireframe()">Descargar</button>
        </div>
        <div id="message"></div>
        <div class="canvas-wrapper">
            <div class="canvas-container">
                <canvas id="drawing-canvas" width="600" height="400"></canvas>
            </div>
            <div class="canvas-container">
                <canvas id="refined-canvas" width="600" height="400"></canvas>
            </div>
        </div>
    </div>

    <script>
        let drawingCanvas, refinedCanvas, isDrawingMode = true;

        function initializeCanvases() {
            drawingCanvas = new fabric.Canvas('drawing-canvas', {
                isDrawingMode: true,
                backgroundColor: 'white'
            });
            refinedCanvas = new fabric.Canvas('refined-canvas', {
                isDrawingMode: false,
                backgroundColor: 'white'
            });
            drawingCanvas.freeDrawingBrush.width = 2;
            drawingCanvas.freeDrawingBrush.color = "#000000";
        }

        function showMessage(text, isSuccess = true) {
            const message = document.getElementById('message');
            message.style.display = 'block';
            message.style.backgroundColor = isSuccess ? '#e8f5e9' : '#ffebee';
            message.style.color = isSuccess ? '#2e7d32' : '#c62828';
            message.textContent = text;
            setTimeout(() => message.style.display = 'none', 3000);
        }

        function interpretElement(path) {
            const bounds = path.getBoundingRect();
            if (Math.abs(bounds.width - bounds.height) < 10 && bounds.width < 50) {
                return { type: 'checkbox', bounds: bounds };
            }
            if (bounds.width > bounds.height * 1.5) {
                return { type: 'input/button', bounds: bounds };
            }
            return { type: 'unknown', bounds: bounds };
        }

        function drawRefinedShape(interpretation) {
            const bounds = interpretation.bounds;
            let shape;
            switch(interpretation.type) {
                case 'checkbox':
                    shape = new fabric.Rect({
                        left: bounds.left,
                        top: bounds.top,
                        width: bounds.width,
                        height: bounds.height,
                        stroke: '#000000',
                        strokeWidth: 2,
                        fill: 'transparent'
                    });
                    break;
                case 'input/button':
                    shape = new fabric.Rect({
                        left: bounds.left,
                        top: bounds.top,
                        width: bounds.width,
                        height: bounds.height,
                        stroke: '#000000',
                        strokeWidth: 2,
                        fill: 'transparent',
                        rx: 4,
                        ry: 4
                    });
                    break;
            }
            if (shape) {
                refinedCanvas.add(shape);
            }
        }

        function interpretWireframe() {
            refinedCanvas.clear();
            refinedCanvas.backgroundColor = 'white';
            const objects = drawingCanvas.getObjects();
            objects.forEach(obj => {
                if (obj.type === 'path') {
                    const interpreted = interpretElement(obj);
                    drawRefinedShape(interpreted);
                }
            });
            refinedCanvas.renderAll();
            showMessage('Wireframe interpretado');
        }

        function toggleDrawingMode() {
            isDrawingMode = !isDrawingMode;
            drawingCanvas.isDrawingMode = isDrawingMode;
            showMessage(isDrawingMode ? 'Modo dibujo activado' : 'Modo selección activado');
        }

        function clearCanvases() {
            drawingCanvas.clear();
            refinedCanvas.clear();
            drawingCanvas.backgroundColor = 'white';
            refinedCanvas.backgroundColor = 'white';
            drawingCanvas.renderAll();
            refinedCanvas.renderAll();
            showMessage('Canvases limpiados');
        }

        function downloadWireframe() {
            const dataURL = refinedCanvas.toDataURL({
                format: 'png',
                quality: 1
            });
            const link = document.createElement('a');
            link.download = 'wireframe.png';
            link.href = dataURL;
            link.click();
            showMessage('Wireframe descargado');
        }

        // Inicializar los canvas cuando se carga la página
        window.onload = initializeCanvases;
    </script>
</body>
</html>
