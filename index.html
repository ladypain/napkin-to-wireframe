// Inicializar ambos canvas
const drawingCanvas = new fabric.Canvas('drawing-canvas', {
    isDrawingMode: true,
    backgroundColor: 'white'
});

const refinedCanvas = new fabric.Canvas('refined-canvas', {
    isDrawingMode: false,
    backgroundColor: 'white'
});

// Configurar el pincel
drawingCanvas.freeDrawingBrush.width = 2;
drawingCanvas.freeDrawingBrush.color = "#000000";

let isDrawingMode = true;

function showMessage(text, isSuccess = true) {
    const message = document.getElementById('message');
    message.style.display = 'block';
    message.style.background = isSuccess ? '#e8f5e9' : '#ffebee';
    message.style.color = isSuccess ? '#2e7d32' : '#c62828';
    message.textContent = text;
    setTimeout(() => {
        message.style.display = 'none';
    }, 3000);
}

function interpretElement(path) {
    const bounds = path.getBoundingRect();
    
    if (Math.abs(bounds.width - bounds.height) < 10 && bounds.width < 50) {
        return { type: 'radio button', bounds: bounds };
    }
    
    if (Math.abs(bounds.width - bounds.height) < 10 && bounds.width < 50) {
        return { type: 'checkbox', bounds: bounds };
    }
    
    if (bounds.width > bounds.height * 1.5) {
        return { type: 'input/button', bounds: bounds };
    }
    
    if (bounds.height < 30) {
        return { type: 'label', bounds: bounds };
    }
    
    return { type: 'unknown', bounds: bounds };
}

function drawRefinedShape(interpretation) {
    let shape;
    const bounds = interpretation.bounds;

    switch(interpretation.type) {
        case 'radio button':
            shape = new fabric.Circle({
                left: bounds.left,
                top: bounds.top,
                radius: Math.min(bounds.width, bounds.height) / 2,
                stroke: '#000000',
                strokeWidth: 2,
                fill: 'transparent'
            });
            break;

        case 'checkbox':
            shape = new fabric.Rect({
                left: bounds.left,
                top: bounds.t
